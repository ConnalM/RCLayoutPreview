<Window x:Class="RCLayoutPreview.EditorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:RCLayoutPreview"
        xmlns:avalonedit="http://icsharpcode.net/sharpdevelop/avalonedit"
        xmlns:controls="clr-namespace:RCLayoutPreview.Controls"
        Title="RC Layout Editor"
        Height="800"
        Width="1200"
        FontFamily="Segoe UI">
    
    <!-- Define icon resources -->
    <Window.Resources>
        <!-- Folder Open Icon for Load -->
        <Path x:Key="FolderOpenIcon" 
              Data="M3,4V1C3,0.45 3.45,0 4,0H10L12,2H20C20.55,2 21,2.45 21,3V4H3M2,6V20C2,21.11 2.89,22 4,22H20C21.11,22 22,21.11 22,20V8C22,6.89 21.11,6 20,6H4C2.89,6 2,6.89 2,6Z"
              Fill="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter}, Path=(TextElement.Foreground)}"
              Stretch="Uniform" Width="16" Height="16"/>
        
        <!-- Save Icon -->
        <Path x:Key="SaveIcon" 
              Data="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"
              Fill="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter}, Path=(TextElement.Foreground)}"
              Stretch="Uniform" Width="16" Height="16"/>
        
        <!-- Clear Icon -->
        <Path x:Key="ClearIcon" 
              Data="M16,6L18.36,8.36L21.73,5L23.14,6.41L19.77,9.77L22.14,12.14L20.73,13.55L18.36,11.18L15,14.55L13.59,13.14L16.95,9.77L13.59,6.41L15,5L16,6M7,14A3,3 0 0,0 10,17A3,3 0 0,0 13,14A3,3 0 0,0 10,11A3,3 0 0,0 7,14M1.5,4V6.5L3,8V19A2,2 0 0,0 5,21H14.5C14.18,20.42 14,19.74 14,19V8L15.5,6.5V4H1.5Z"
              Fill="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter}, Path=(TextElement.Foreground)}"
              Stretch="Uniform" Width="16" Height="16"/>
        
        <!-- Preview/Play Icon -->
        <Path x:Key="PreviewIcon" 
              Data="M8,5.14V19.14L19,12.14L8,5.14Z"
              Fill="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter}, Path=(TextElement.Foreground)}"
              Stretch="Uniform" Width="16" Height="16"/>
        
        <!-- Search Icon -->
        <Path x:Key="SearchIcon" 
              Data="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"
              Fill="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter}, Path=(TextElement.Foreground)}"
              Stretch="Uniform" Width="16" Height="16"/>
        
        <!-- Find Replace Icon -->
        <Path x:Key="FindReplaceIcon" 
              Data="M11,6C13.38,6.19 15.19,8.14 15,10.5C14.9,11.41 14.5,12.27 13.9,12.9L17,16L15.5,17.5L12.4,14.4C11.77,14.9 10.91,15.21 10,15.3C7.62,15.11 5.81,13.16 6,10.8C6.1,9.89 6.5,9.03 7.1,8.4L7.1,8.4C8.13,7.25 9.53,6.69 11,6M10.5,7.5C9.64,7.5 8.83,7.84 8.24,8.44C7.64,9.03 7.31,9.84 7.31,10.7C7.31,11.56 7.64,12.37 8.24,12.96C8.83,13.56 9.64,13.89 10.5,13.89C11.36,13.89 12.17,13.56 12.76,12.96C13.36,12.37 13.69,11.56 13.69,10.7C13.69,9.84 13.36,9.03 12.76,8.44C12.17,7.84 11.36,7.5 10.5,7.5M20.3,18.9C20.84,19.54 20.84,20.5 20.3,21.04C19.76,21.58 18.8,21.58 18.26,21.04L15.95,18.75C16.5,18.14 17,17.5 17.41,16.83L20.3,18.9M1.39,4.58L2.8,3.17L6.32,6.69C6.82,7.5 7.38,8.26 7.97,8.97L4.27,12.68C3.9,13.05 3.9,13.67 4.27,14.04C4.64,14.41 5.26,14.41 5.63,14.04L9.34,10.34C10.39,11.34 11.5,12.24 12.69,13L9.06,16.64C8.69,17 8.69,17.62 9.06,18C9.43,18.36 10.05,18.36 10.42,18L20.84,7.58L22.25,9L1.39,4.58Z"
              Fill="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter}, Path=(TextElement.Foreground)}"
              Stretch="Uniform" Width="16" Height="16"/>
        
        <!-- Error icon -->
        <Path x:Key="ErrorIcon" 
              Data="M12,2L13.09,8.26L22,9L13.09,9.74L12,16L10.91,9.74L2,9L10.91,8.26L12,2M12,7A2,2 0 0,0 10,9A2,2 0 0,0 12,11A2,2 0 0,0 14,9A2,2 0 0,0 12,7Z"
              Fill="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter}, Path=(TextElement.Foreground)}"
              Stretch="Uniform" Width="16" Height="16"/>
        
        <!-- Clock History Icon for Recent Files -->
        <Path x:Key="HistoryIcon" 
              Data="M13.5,8H12V13L16.28,15.54L17,14.33L13.5,12.25V8M13,3A9,9 0 0,0 4,12H1L4.96,16.03L9,12H6A7,7 0 0,1 13,5A7,7 0 0,1 20,12A7,7 0 0,1 13,19C11.07,19 9.32,18.21 8.06,16.94L6.64,18.36C8.27,20 10.5,21 13,21A9,9 0 0,0 22,12A9,9 0 0,0 13,3"
              Fill="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter}, Path=(TextElement.Foreground)}"
              Stretch="Uniform" Width="16" Height="16"/>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Menu Bar -->
            <RowDefinition Height="Auto"/>
            <!-- Toolbar -->
            <RowDefinition Height="Auto"/>
            <!-- Settings Panel -->
            <RowDefinition Height="*"/>
            <!-- Main Content -->
            <RowDefinition Height="Auto"/>
            <!-- Optional bottom status -->
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <Menu Grid.Row="0" Height="22" Name="menu1" VerticalAlignment="Top">
            <MenuItem Header="File">
                <MenuItem Name="LoadLayout_1" Header="Load Layout..." Click="LoadLayout_Click"
                          InputGestureText="Ctrl+O"
                          ToolTip="Load a XAML layout file" />
                
                <!-- Recent Files submenu -->
                <MenuItem Name="RecentFiles_1" Header="Recent Files" 
                          ToolTip="Open recently used XAML files">
                    <MenuItem x:Name="RecentFilesPlaceholder" Header="(No recent files)" IsEnabled="False"/>
                </MenuItem>
                
                <Separator/>
                
                <MenuItem Name="Save_1" Header="Save" Click="SaveLayout_Click"
                          DataContext="'key':'S','modifier':'Ctrl'" 
                          InputGestureText="Ctrl+S"
                          ToolTip="Save the current layout" />
                          
                <MenuItem Name="SaveAs_1" Header="Save As..." Click="SaveAsLayout_Click"
                          DataContext="'key':'S','modifier':'Ctrl+Shift'" 
                          InputGestureText="Ctrl+Shift+S"
                          ToolTip="Save the layout with a new file name" />
                          
                <Separator/>
                
                <MenuItem Name="Close_1" Header="Close" Click="CloseEditor_Click"
                          DataContext="'key':'F4','modifier':'Alt'" 
                          InputGestureText="Alt+F4"
                          ToolTip="Close the editor" />
            </MenuItem>
            
            <MenuItem Header="Edit">
                <MenuItem Name="Clear_1" Header="Clear Editor" Click="ClearEditor_Click"
                          DataContext="'key':'Delete','modifier':'Ctrl+Shift'" 
                          InputGestureText="Ctrl+Shift+Del"
                          ToolTip="Clear all content from the editor" />
                          
                <Separator/>
                
                <MenuItem Name="Find_1" Header="Find..." 
                          InputGestureText="Ctrl+F"
                          ToolTip="Find text in the editor (built-in search)" />
                          
                <MenuItem Name="Replace_1" Header="Find and Replace..." 
                          InputGestureText="Ctrl+H"
                          ToolTip="Find and replace text in the editor" />
                          
                <Separator/>
                
                <MenuItem Name="GoToError_1" Header="Go to Last Error" Click="GoToLastError_Click"
                          InputGestureText="F8"
                          ToolTip="Navigate to the last XAML parsing error location" />
            </MenuItem>
            
            <MenuItem Header="View">
                <MenuItem Name="Preview_1" Header="Refresh Preview" Click="PreviewButton_Click"
                          DataContext="'key':'F5','modifier':''" 
                          InputGestureText="F5"
                          ToolTip="Manually refresh the preview window" />
                          
                <Separator/>
                
                <MenuItem Name="AutoUpdate_1" Header="Auto-Update Preview" 
                          IsCheckable="True" IsChecked="{Binding ElementName=AutoUpdateToggle, Path=IsChecked}"
                          ToolTip="Enable/disable automatic preview updates" />
            </MenuItem>
            
        </Menu>

        <!-- Icon Toolbar -->
        <ToolBarTray Grid.Row="1" Background="#F0F0F0">
            <ToolBar Band="0" BandIndex="0" Background="Transparent" BorderThickness="0">
                <!-- File operations -->
                <Button Click="LoadLayout_Click" ToolTip="Load Layout (Ctrl+O)" 
                        Style="{DynamicResource {x:Static ToolBar.ButtonStyleKey}}" 
                        Padding="4" Margin="2,1">
                    <ContentPresenter Content="{StaticResource FolderOpenIcon}"/>
                </Button>
                
                <Button x:Name="RecentFilesToolbarButton" ToolTip="Recent Files" 
                        Style="{DynamicResource {x:Static ToolBar.ButtonStyleKey}}"
                        Padding="4" Margin="2,1" Click="RecentFilesToolbar_Click">
                    <ContentPresenter Content="{StaticResource HistoryIcon}"/>
                </Button>
                
                <Separator Margin="3,0"/>
                
                <Button Click="SaveLayout_Click" ToolTip="Save (Ctrl+S)" 
                        Style="{DynamicResource {x:Static ToolBar.ButtonStyleKey}}" 
                        Padding="4" Margin="2,1">
                    <ContentPresenter Content="{StaticResource SaveIcon}"/>
                </Button>
                
                <Separator Margin="3,0"/>
                
                <!-- Edit operations -->
                <Button Click="ClearEditor_Click" ToolTip="Clear Editor (Ctrl+Shift+Del)" 
                        Style="{DynamicResource {x:Static ToolBar.ButtonStyleKey}}" 
                        Padding="4" Margin="2,1">
                    <ContentPresenter Content="{StaticResource ClearIcon}"/>
                </Button>
                
                <Button Click="ShowFindDialog" ToolTip="Find and Replace (Ctrl+H)" 
                        Style="{DynamicResource {x:Static ToolBar.ButtonStyleKey}}" 
                        Padding="4" Margin="2,1">
                    <ContentPresenter Content="{StaticResource FindReplaceIcon}"/>
                </Button>
                
                <Separator Margin="3,0"/>
                
                <!-- Preview operations -->
                <Button Click="PreviewButton_Click" ToolTip="Refresh Preview (F5)" 
                        Style="{DynamicResource {x:Static ToolBar.ButtonStyleKey}}" 
                        Padding="4" Margin="2,1">
                    <ContentPresenter Content="{StaticResource PreviewIcon}"/>
                </Button>
                
                <Button x:Name="GoToErrorButton" Click="GoToLastError_Click" ToolTip="Go to Last Error (F8)" 
                        Style="{DynamicResource {x:Static ToolBar.ButtonStyleKey}}" 
                        Padding="4" Margin="2,1">
                    <ContentPresenter Content="{StaticResource ErrorIcon}"/>
                </Button>
            </ToolBar>
        </ToolBarTray>

        <!-- Settings Panel -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="10,5" Background="#F0F0F0">
            <CheckBox x:Name="AutoUpdateToggle" Content="Auto-Update" IsChecked="True" 
                      VerticalAlignment="Center" Margin="0,0,15,0"
                      Checked="AutoUpdateToggle_Changed" Unchecked="AutoUpdateToggle_Changed" 
                      ToolTip="Enable/disable automatic preview updates"/>
            <TextBlock Text="Delay (ms):" Margin="0,0,5,0" VerticalAlignment="Center"/>
            <TextBox x:Name="DelayInput" Width="50" Text="3000" VerticalAlignment="Center" 
                     TextChanged="DelayInput_TextChanged" 
                     ToolTip="Delay in milliseconds before auto-preview triggers"/>
        </StackPanel>

        <!-- Main Content -->
        <Grid Grid.Row="3">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Status Line -->
            <Border Grid.Row="0" Background="#E8E8E8" BorderBrush="#D0D0D0" BorderThickness="0,0,0,1">
                <TextBlock x:Name="StatusLabel" Text="Ready" Foreground="DarkBlue" 
                           Margin="10,4" VerticalAlignment="Center" FontSize="11"/>
            </Border>
            
            <!-- Error message area -->
            <TextBlock x:Name="ErrorMessage" Grid.Row="0" Text="" Foreground="Red" 
                       Margin="10" Visibility="Collapsed" Background="LightYellow"
                       Padding="5" FontWeight="Bold"/>

            <!-- Main Editor area -->
            <Grid Grid.Row="1" Margin="5">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="15*" MinWidth="100"/>
                    <!-- JSON Fields -->
                    <ColumnDefinition Width="5"/>
                    <!-- First GridSplitter -->
                    <ColumnDefinition Width="20*" MinWidth="100"/>
                    <!-- Snippet Gallery -->
                    <ColumnDefinition Width="5"/>
                    <!-- Second GridSplitter -->
                    <ColumnDefinition Width="65*" MinWidth="200"/>
                    <!-- XAML Editor -->
                </Grid.ColumnDefinitions>

                <!-- JSON Fields Panel -->
                <Grid Grid.Column="0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <!-- Added for JSON Search -->
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Text="JSON Fields" 
                             FontWeight="Bold" 
                             Margin="5"/>

                    <!-- JSON Search Panel -->
                    <TextBox x:Name="JsonSearchBox" 
                             Grid.Row="1" 
                             Margin="5" 
                             Text="Search JSON fields..." 
                             Foreground="Gray" 
                             GotFocus="JsonSearchBox_GotFocus" 
                             LostFocus="JsonSearchBox_LostFocus" 
                             TextChanged="JsonSearchBox_TextChanged"/>

                    <Border Grid.Row="2" 
                            x:Name="FieldsPanel" 
                            BorderBrush="#FFD0D0D0" 
                            BorderThickness="1">
                        <TreeView x:Name="JsonFieldsTree"
                                 AllowDrop="True"
                                 PreviewMouseLeftButtonDown="JsonFieldsTree_PreviewMouseLeftButtonDown"
                                 MouseDoubleClick="JsonFieldsTree_MouseDoubleClick"/>
                    </Border>
                </Grid>

                <!-- First GridSplitter -->
                <GridSplitter Grid.Column="1"
                             ResizeDirection="Columns"
                             ResizeBehavior="PreviousAndNext"
                             Background="#FFE0E0E0"
                             HorizontalAlignment="Stretch"
                             VerticalAlignment="Stretch"/>

                <!-- Snippet Gallery -->
                <Grid Grid.Column="2">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Text="Layout Snippets" 
                             FontWeight="Bold" 
                             Margin="5"/>

                    <Border Grid.Row="1" 
                            BorderBrush="#FFD0D0D0" 
                            BorderThickness="1">
                        <controls:SnippetGallery x:Name="SnippetGallery"/>
                    </Border>
                </Grid>

                <!-- Second GridSplitter -->
                <GridSplitter Grid.Column="3"
                             ResizeDirection="Columns"
                             ResizeBehavior="PreviousAndNext"
                             Background="#FFE0E0E0"
                             HorizontalAlignment="Stretch"
                             VerticalAlignment="Stretch"/>

                <!-- XAML Editor Panel -->
                <Border Grid.Column="4" x:Name="EditorPanel" BorderBrush="#FFD0D0D0" BorderThickness="1">
                    <avalonedit:TextEditor
                        x:Name="Editor"
                        FontFamily="Consolas"
                        FontSize="14"
                        ShowLineNumbers="True"
                        WordWrap="True"
                        SyntaxHighlighting="XML"
                        Background="White"
                        Foreground="Black"
                        HorizontalScrollBarVisibility="Auto"
                        VerticalScrollBarVisibility="Auto">
                        <avalonedit:TextEditor.Options>
                            <avalonedit:TextEditorOptions
                                EnableHyperlinks="True"
                                EnableEmailHyperlinks="True"
                                EnableVirtualSpace="False"
                                ShowSpaces="False"
                                ShowTabs="False"
                                ShowEndOfLine="False"
                                AllowToggleOverstrikeMode="False"
                                EnableRectangularSelection="True"
                                EnableTextDragDrop="True"
                                ConvertTabsToSpaces="True"
                                IndentationSize="4"/>
                        </avalonedit:TextEditor.Options>
                    </avalonedit:TextEditor>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</Window>