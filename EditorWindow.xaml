<Window x:Class="RCLayoutPreview.EditorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:RCLayoutPreview"
        xmlns:avalonedit="http://icsharpcode.net/sharpdevelop/avalonedit"
        xmlns:controls="clr-namespace:RCLayoutPreview.Controls"
        Title="RC Layout Editor"
        Height="800"
        Width="1200"
        FontFamily="Segoe UI">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/> <!-- Added for ErrorMessage -->
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Top toolbar -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="10" HorizontalAlignment="Left" VerticalAlignment="Top">
            <Button Content="Load Layout" Click="LoadLayout_Click" Margin="0,0,8,0" Width="100" Height="30"/>
            
            <!-- Recent Files Button with Dropdown -->
            <Button x:Name="RecentFilesButton" Width="100" Height="30" Margin="0,0,8,0" Click="RecentFiles_Click"
                    ToolTip="Open recently used XAML files">
                <Button.Content>
                    <StackPanel Orientation="Horizontal">
                        <Path Data="M3,3 L13,3 L13,5 L3,5 Z M3,7 L13,7 L13,9 L3,9 Z M3,11 L13,11 L13,13 L3,13 Z M1,1 L1,15 L15,15 L15,1 Z M2,2 L14,2 L14,14 L2,14 Z" 
                              Fill="Black" Width="12" Height="12" Margin="0,0,3,0" VerticalAlignment="Center"/>
                        <TextBlock Text="Recent" VerticalAlignment="Center" FontSize="11"/>
                        <Path Data="M0,0 L3,3 L6,0" Stroke="Black" StrokeThickness="1" 
                              Margin="3,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button.Content>
                <Button.ContextMenu>
                    <ContextMenu Placement="Bottom">
                        <!-- Recent files will be populated dynamically -->
                    </ContextMenu>
                </Button.ContextMenu>
            </Button>
            
            <Button Content="Save Layout" Click="SaveLayout_Click" Margin="0,0,8,0" Width="100" Height="30"/>
            <Button Content="Save As" Click="SaveAsLayout_Click" Margin="0,0,8,0" Width="100" Height="30"/>
            <Button Content="Close" Click="CloseEditor_Click" Margin="0,0,8,0" Width="100" Height="30"/>
            <Button Content="Clear Editor" Click="ClearEditor_Click" Margin="0,0,8,0" Width="100" Height="30"/>
            <Button Name="PreviewButton" Content="Preview" Width="100" Height="30" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="0,0,8,0" Click="PreviewButton_Click"/>
            <CheckBox x:Name="AutoUpdateToggle" Content="Auto-Update" IsChecked="True" Margin="10,0,0,0" VerticalAlignment="Center" 
                      Checked="AutoUpdateToggle_Changed" Unchecked="AutoUpdateToggle_Changed" Height="30"/>
            <TextBlock Text="Delay (ms): " Margin="10,0,0,0" VerticalAlignment="Center" Height="30"/>
            <TextBox x:Name="DelayInput" Width="50" Text="3000" VerticalAlignment="Center" TextChanged="DelayInput_TextChanged" Height="30"/>
            
        </StackPanel>

        <!-- Error message area -->
        <TextBlock x:Name="StatusLabel" Grid.Row="1" Text="Ready" Foreground="Gray" Margin="10,4,0,4" VerticalAlignment="Center" Height="30"/>
        <TextBlock x:Name="ErrorMessage" Grid.Row="1" Text="" Foreground="Red" Margin="10,10,10,10" Visibility="Collapsed"/>

        <!-- Editor area -->
        <Grid Grid.Row="2" Margin="5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="15*" MinWidth="100"/> <!-- JSON Fields -->
                <ColumnDefinition Width="5"/> <!-- First GridSplitter -->
                <ColumnDefinition Width="20*" MinWidth="100"/> <!-- Snippet Gallery -->
                <ColumnDefinition Width="5"/> <!-- Second GridSplitter -->
                <ColumnDefinition Width="65*" MinWidth="200"/> <!-- XAML Editor -->
            </Grid.ColumnDefinitions>

            <!-- JSON Fields Panel -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/> <!-- Added for JSON Search -->
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <TextBlock Text="JSON Fields" 
                         FontWeight="Bold" 
                         Margin="5"/>
                
                <!-- JSON Search Panel -->
                <TextBox x:Name="JsonSearchBox" 
                         Grid.Row="1" 
                         Margin="5" 
                         Text="Search JSON fields..." 
                         Foreground="Gray" 
                         GotFocus="JsonSearchBox_GotFocus" 
                         LostFocus="JsonSearchBox_LostFocus" 
                         TextChanged="JsonSearchBox_TextChanged"/>

                <Border Grid.Row="2" 
                        x:Name="FieldsPanel" 
                        BorderBrush="#FFD0D0D0" 
                        BorderThickness="1">
                    <TreeView x:Name="JsonFieldsTree"
                             AllowDrop="True"
                             PreviewMouseLeftButtonDown="JsonFieldsTree_PreviewMouseLeftButtonDown"
                             MouseDoubleClick="JsonFieldsTree_MouseDoubleClick"/>
                </Border>
            </Grid>

            <!-- First GridSplitter -->
            <GridSplitter Grid.Column="1"
                         ResizeDirection="Columns"
                         ResizeBehavior="PreviousAndNext"
                         Background="#FFE0E0E0"
                         HorizontalAlignment="Stretch"
                         VerticalAlignment="Stretch"/>

            <!-- Snippet Gallery -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <TextBlock Text="Layout Snippets" 
                         FontWeight="Bold" 
                         Margin="5"/>
                
                <Border Grid.Row="1" 
                        BorderBrush="#FFD0D0D0" 
                        BorderThickness="1">
                    <controls:SnippetGallery x:Name="SnippetGallery"/>
                </Border>
            </Grid>

            <!-- Second GridSplitter -->
            <GridSplitter Grid.Column="3"
                         ResizeDirection="Columns"
                         ResizeBehavior="PreviousAndNext"
                         Background="#FFE0E0E0"
                         HorizontalAlignment="Stretch"
                         VerticalAlignment="Stretch"/>

            <!-- XAML Editor Panel -->
            <Border Grid.Column="4" x:Name="EditorPanel" BorderBrush="#FFD0D0D0" BorderThickness="1">
                <avalonedit:TextEditor
                    x:Name="Editor"
                    FontFamily="Consolas"
                    FontSize="14"
                    ShowLineNumbers="True"
                    WordWrap="True"
                    SyntaxHighlighting="XML"
                    Background="White"
                    Foreground="Black"
                    HorizontalScrollBarVisibility="Auto"
                    VerticalScrollBarVisibility="Auto">
                    <avalonedit:TextEditor.Options>
                        <avalonedit:TextEditorOptions
                            EnableHyperlinks="True"
                            EnableEmailHyperlinks="True"
                            EnableVirtualSpace="False"
                            ShowSpaces="False"
                            ShowTabs="False"
                            ShowEndOfLine="False"
                            AllowToggleOverstrikeMode="False"
                            EnableRectangularSelection="True"
                            EnableTextDragDrop="True"
                            ConvertTabsToSpaces="True"
                            IndentationSize="4"/>
                    </avalonedit:TextEditor.Options>
                </avalonedit:TextEditor>
            </Border>
        </Grid>
    </Grid>
</Window>